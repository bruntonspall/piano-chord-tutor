/*! piano-chord-tutor 2014-09-27 */
function hideNotes(a){for(var b=a.getSVGDocument(),c=b.getElementById("notes"),d=c.querySelectorAll("*"),e=0;e!=d.length;e++)d[e].style.opacity=0}function showNote(a,b){var c=a.getSVGDocument(),d=c.getElementById("note-"+b);d&&(d.style.opacity=100)}function showChord(a,b,c){console.log("Playing "+b+" "+c),hideNotes(a),null===c&&(c="root");var d=a.parentElement.querySelector("h2");d&&(d.innerHTML=b+" "+c);for(var e=playableChord(b,c),f=0;f!=e.length;f++)showNote(a,e[f])}function playNote(a){var b=circle[currentNote];showChord(a,b,currentNote%2===0?"root":"middle"),++currentNote==circle.length&&(currentNote=0),a.querySelector("#next_chord").innerHTML="Next: "+circle[currentNote]+" "+(currentNote%2===0?"root":"middle")}function startCircle(){var a=document.getElementById("play");playing?(window.clearInterval(playing),playing=!1,currentNote=0,a.innerHTML="Play"):(playing=window.setInterval(function(){playNote(g_keyboard)},2500),a.innerHTML="Stop")}function createKeyboard(){var a=document.createElement("div");a.classList.add("keyboard-block");var b=document.createElement("h2");a.appendChild(b);var c=document.createElement("object");return c.type="image/svg+xml",c.data="keyboard.svg",a.appendChild(c),a}function showCircle(){for(var a=document.getElementById("placement"),b=calculateCircle(),c=0;c!=b.length;++c){var d=b[(c+8)%b.length],e=createKeyboard(),f=e.querySelector("object");f.id="chord-"+c,function(a,b,c){f.addEventListener("load",function(){showChord(a,b,c%2===0?"root":"middle")})}(f,d,c),a.appendChild(e)}}function playableChord(a,b){var c=notesForChord(a,b),d=["c-1","csharp-1","d-1","eflat-1","e-1","f-1","fsharp-1","g-1","aflat-1","a-1","bflat-1","b-1","c-2","csharp-2","d-2","eflat-2","e-2","f-2","fsharp-2","g-2","aflat-2","a-2","bflat-2","b-2"];result=[],note=0;for(var e=0;e!=d.length&&!(d[e].substring(0,d[e].length-2)===c[note]&&(result.push(d[e]),note+=1,note>3));++e);return result}function lookupNote(a){return notes[a%12]}function notesForChord(a,b){var c=a.toLowerCase(),d=[0,4,7];a.length>1&&"m"==a[a.length-1]&&(d=[0,3,7],c=a.substr(0,a.length-1));for(var e=0;e!=notes.length&&notes[e]!==c;++e);var f=inversions[b];return[lookupNote(e+d[f[0]]),lookupNote(e+d[f[1]]),lookupNote(e+d[f[2]])]}function calculateCircle(){result=[];for(var a=0;12>a;++a)result.push(notes[5*a%12]);return result}var currentNote=0,playing=!1,g_keyboard=null,notes=["c","csharp","d","eflat","e","f","fsharp","g","aflat","a","bflat","b"],inversions={root:[0,1,2],middle:[2,0,1],back:[1,2,0]};